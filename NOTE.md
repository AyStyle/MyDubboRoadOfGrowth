# Dubbo
Dubbo是一款高性能的Java RPC 框架

## 项目架构演变过程
单体架构到微服务架构的演变，案例：拉勾网架构演变

### 单体架构
+ 优点
   1. 小项目开发快成本低
   2. 架构简单
   3. 易于测试
   4. 易于部署
   
+ 缺点
   1. 大项目模块耦合严重，不易于开发和维护，且沟通成本高
   2. 新增业务困难
   3. 核心业务与边缘业务混合在一起，出现问题相互影响
   
### 垂直架构
+ 优点
   1. 系统拆分实现了流量分担，解决了并发问题
   2. 可以针对不同系统进行优化
   3. 方便水平扩展，负载均衡，容错率提高
   4. 系统间相互独立，互不影响，新业务迭代时更加高效
   
+ 缺点
   1. 服务系统之间接口调用硬编码
   2. 搭建集群之后，实现负载均衡比较复杂
   3. 服务系统接口调用监控不到位，调用方式不统一
   4. 服务监控不到位
   5. 数据库资源浪费，充斥着慢查询，主从同步延迟大

### 分布式架构 （SOA）
+ 分层：按照业务性质分层，每一层要求简单和易于维护

     1. 应用层：
           ```
           距离用户最近的一层，也称之为接入层。使用Tomcat作为web容器，
           接收用户请求并使用下游的Dubbo提供的接口返回数据，并且该层禁止访问数据库
           ```
     2. 业务层：
          ```
          拉钩网招聘业务的核心、账号、简历、公司和职位
          ```
     3. 服务层：
           ```
           通用服务、消息服务、短链接、附件解析和定时任务平台
           这一层与业务无关，这一层的特点是：请求量大、逻辑简单、特性明显、功能独立
           ```            
     4. 存储层：
           ```
           不同的存储类型Mysql MongoDB ES FastDFS
           ```

+ 分级：按照业务性质分层，同一层的业务也要做好分级，依据业务的重要性进行分级，按照二八定律
     网站80%的流量都在核心功能上面要优先保证核心业务的稳定。
     
     
+ 隔离：不同性质、不同重要性的业务做好隔离，包括：业务、缓存、DB、中间件都要做好隔离，
     比如：核心业务的数据库要和活动相关的数据库隔离
     
+ 调用：总体上调用要单相可以跨级调用，但不容许逆向调用     
     
+ 优点：
   1. 服务以接口为粒度，为开发者屏蔽远程调用底层细节
   2. 业务分层以后架构更加清晰，并且每个业务模块职责单一，扩展性更强
   3. 数据隔离，权限回收，数据访问都通过接口，让系统更加稳定安全
   4. 服务应用本身无状态化（这里的无状态化指的是应用本身不做内存级缓存，而是把数据存入db）
   5. 服务责任易确定，每个服务可以确定责任人，这样更容易保证服务质量和稳定
   
+ 缺点：
   1. 粒度控制复杂，如果没有控制好服务的粒度，服务的模块就会越来越多，就会引发超时分布式事务等问题
   2. 服务接口数量不宜控制，容易引发接口爆炸，所以服务接口建议以业务场景进行单位划分，并对相近的业务做抽象，防止接口爆炸
   3. 版本升级兼容困难，尽量不要删除方法、字段，并且枚举类型字段的新增也容易导致不兼容
   4. 调用链路长服务质量不可监控，下游抖动可能会影响到上游业务最终形成连锁反应，导致服务质量不稳定
   
### 微服务架构

### Dubbo处理流程
+ 节点说明：

   | 节点|角色名称|
   |:---:|:---|
   |Provider|暴露服务的服务提供方|
   |Consumer|远程服务的服务消费方|
   |Registry|服务注册与发现的注册中心|
   |Monitor|统计服务的调用次数和调用时间的监控中心|
   |Container|服务运行容器，负责启动、加载、运行服务的提供者|
   
+ 调用关系说明：
   虚线代表异步调用，实线代表同步访问
   蓝色虚线：启动时完成
   红色虚线：程序运行中执行的功能
   
+ 调用流程：
  1. 容器启动服务提供方
  2. 服务提供方向注册中心注册服务，如果服务有变更，则会通知注册中心
  3. 服务消费者向注册中心订阅服务，如果服务有变更，则注册中心会通知
  4. 服务消费者调用服务提供者，基于软负载均衡算法选择一台服务提供者，如果调用失败，则重新选择一台
  5. 每分钟服务消费者和服务提供者向监控中心发送调用次数

### Dubbo配置
1. 注解：
   ```text
       基于注解可以快速的将程序配置，无需多余的配置信息，包含提供者和消费者。
   但是这种方式有一个弊端，有些时候配置信息并不是特别好找，无法快速定位。   
   ```

2. XML：
   ```text
       一般这种方式会和Spring做结合，相关的Service和Reference均使用Spring集成后的程序。
   通过这样的方式可以很方便的通过几个文件进行管理整个集群配置。可以快速定位也可以快速更改。
   ```

3. 代码：
   ```text
       基于代码方式配置。这种方式使用比较少，且这种方式适用于自己公司对其框架与Dubbo做深度集成时才会使用。
   ```
  
## Dubbo架构与实战
Dubbo的架构（调用流程 特性）
注册中心
案例开发（注解和XML）
Dubbo的管理控制台
Dubbo的相关配置

## Dubbo高级应用实战
SPI 负载均衡
异步调用
自定义线程池
路由规则
服务降级

## Dubbo源码分析
Dubbo的整体设计
服务注册与发现的源码剖析
Dubbo扩展SPI分析
集群容器的源码分析
网络通信原理分析